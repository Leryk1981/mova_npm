{
  "version": "3.3",
  "$comment": "WooCommerce: Bestellungen mit Paginierung abrufen und in NDJSON speichern.",
  "aktionen": [
    {
      "typ": "geheimnis_holen",
      "name": "<CK_SECRET_NAME>",
      "out": "vars.ck"
    },
    {
      "typ": "geheimnis_holen",
      "name": "<CS_SECRET_NAME>",
      "out": "vars.cs"
    },
    {
      "typ": "variable_setzen",
      "variable": "vars.base",
      "wert": "<BASE_URL>"
    },
    {
      "typ": "variable_setzen",
      "variable": "vars.page",
      "wert": 1
    },
    {
      "typ": "wiederholen",
      "anzahl": 10,
      "aktionen": [
        {
          "typ": "http_anfrage",
          "methode": "GET",
          "url": "${vars.base}/wp-json/wc/v3/orders",
          "auth": {
            "typ": "basic",
            "username": "${vars.ck}",
            "password": "${vars.cs}"
          },
          "query": {
            "per_page": 100,
            "page": "${vars.page}",
            "status": "<STATUS>",
            "after": "<AFTER_ISO>"
          },
          "out": "vars.page_data"
        },
        {
          "typ": "bedingung",
          "ausdruck": "${Array.isArray(vars.page_data) && vars.page_data.length > 0}",
          "dann": [
            {
              "typ": "für_jedes",
              "liste": "${vars.page_data}",
              "schleifen_variable": "order",
              "aktionen": [
                {
                  "typ": "datei_schreiben",
                  "pfad": "<OUT_FILE>",
                  "wert": "${order}",
                  "modus": "append_jsonl"
                }
              ]
            },
            {
              "typ": "variable_setzen",
              "variable": "vars.page",
              "wert": "${vars.page + 1}"
            }
          ],
          "sonst": [
            {
              "typ": "rückgabe",
              "wert": "done"
            }
          ]
        }
      ]
    }
  ]
}