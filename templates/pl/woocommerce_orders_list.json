{
  "wersja": "3.3",
  "$comment": "WooCommerce: pobrać zamówienia z paginacją i zapisać w NDJSON.",
  "akcje": [
    {
      "typ": "pobrać_sekret",
      "name": "<CK_SECRET_NAME>",
      "out": "vars.ck"
    },
    {
      "typ": "pobrać_sekret",
      "name": "<CS_SECRET_NAME>",
      "out": "vars.cs"
    },
    {
      "typ": "ustawić_zmienną",
      "zmienna": "vars.base",
      "wartość": "<BASE_URL>"
    },
    {
      "typ": "ustawić_zmienną",
      "zmienna": "vars.page",
      "wartość": 1
    },
    {
      "typ": "powtórzyć",
      "liczba": 10,
      "akcje": [
        {
          "typ": "żądanie_http",
          "metoda": "GET",
          "url": "${vars.base}/wp-json/wc/v3/orders",
          "auth": {
            "typ": "basic",
            "username": "${vars.ck}",
            "password": "${vars.cs}"
          },
          "query": {
            "per_page": 100,
            "page": "${vars.page}",
            "status": "<STATUS>",
            "after": "<AFTER_ISO>"
          },
          "out": "vars.page_data"
        },
        {
          "typ": "warunek",
          "wyrażenie": "${Array.isArray(vars.page_data) && vars.page_data.length > 0}",
          "wtedy": [
            {
              "typ": "dla_każdego",
              "lista": "${vars.page_data}",
              "zmienna_pętli": "order",
              "akcje": [
                {
                  "typ": "zapisać_plik",
                  "ścieżka": "<OUT_FILE>",
                  "wartość": "${order}",
                  "tryb": "append_jsonl"
                }
              ]
            },
            {
              "typ": "ustawić_zmienną",
              "zmienna": "vars.page",
              "wartość": "${vars.page + 1}"
            }
          ],
          "inaczej": [
            {
              "typ": "zwrócić",
              "wartość": "done"
            }
          ]
        }
      ]
    }
  ]
}