{
  "route_version": "1.0",
  "$comment": "Shopify orders/create: перевірка HMAC + запис у NDJSON.",
  "trigger": {
    "type": "http",
    "http": {
      "path": "/webhooks/shopify/orders/create",
      "method": "POST"
    }
  },
  "invoke": {
    "plan": {
      "mova_version": "3.3",
      "actions": [
        {
          "type": "secrets.get",
          "name": "SHOPIFY_WEBHOOK_SECRET",
          "out": "vars.webhook_secret"
        },
        {
          "type": "shopify_verify_webhook",
          "secret_value": "${vars.webhook_secret}"
        },
        {
          "type": "file_append_jsonl",
          "path": "out/shopify_orders.ndjson",
          "value": "${payload}"
        },
        {
          "type": "print",
          "message": "OK orders/create ${payload.id}"
        }
      ]
    },
    "plan_ref": "webhook.shopify_orders_create"
  }
}
